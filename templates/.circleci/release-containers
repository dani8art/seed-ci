{{#if deployment.packageType "===" "docker"}}
#!/bin/bash

{{#if release.enabled}}
MAIN_TAG="$(npm run --silent get:version)"
{{else}}
MAIN_TAG="$CIRCLE_BRANCH"
{{/if}}

echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin

# Release main tags
docker build -t {{deployment.docker.image}}:$MAIN_TAG .
docker push {{deployment.docker.image}}:$MAIN_TAG

# Release additionals tags
{{#each deployment.docker.additionalTags}}
docker tag {{@root.deployment.docker.image}}:$MAIN_TAG {{@root.deployment.docker.image}}:{{this}}
docker push {{@root.deployment.docker.image}}:{{this}}
{{/each}}

{{/if}}